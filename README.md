# concourse-up
A Quick setup of a concourse server with Docker Compose with reference from https://github.com/concourse/concourse-docker

# Prerequisites
  - Certificates and keys generated and exchanged for the web and workers (ref section below)
  - Docker is installed (Compose should be installed with it) ref https://docs.docker.com/install/

# Setting up Certificates and keys

Run the commands below to create the folders and exchange keys used for communications between the web and worker processes

mkdir -p ~/Dev/docker/keys/web ~/Dev/docker/keys/worker ~/Dev/docker/mounts/concourse/worker

**Create ssl keys for concourse host**  
ssh-keygen -t rsa -f ~/Dev/docker/keys/web/tsa_host_key -N ''

ssh-keygen -t rsa -f ~/Dev/docker/keys/web/session_signing_key -N ''

**Create ssl keys for worker**  
ssh-keygen -t rsa -f ~/Dev/docker/keys/worker/worker_key -N ''

**Exchange the keys between the host and workers for communications**  
cp ~/Dev/docker/keys/worker/worker_key.pub ~/Dev/docker/keys/web/authorized_worker_keys

cp ~/Dev/docker/keys/web/tsa_host_key.pub ~/Dev/docker/keys/worker

**Multiple Workers**

If more workers are required, do the following:
- Generate ssl keys for the worker in a seperate folder
- copy host key to new worker folder
- copy worker key to host's authorized worker keys
- create a copy of the 'concourse-worker' section in docker-compose.yml, and point the volume to the new worker folder

# Usage
Disclaimer: if other folder locations are used other than the ones specified above, update the locations in the docker-compose.yml

- Copy docker-compose.yml file to any file location
- start up the instances with 'docker-compose up' ('docker-compose up -d' for detached processes)
- shutdown and clean up processes with 'docker-compose down'

# Note
The disk can get filled up from the docker images generated by the jobs over time, periodically clean out unused images with "docker image prune" command

Direct your feedback to Jason at hklee@pivotal.io
